<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Metric Attribution Data Element</title>
    <link rel="stylesheet" href="../dist/css/coral.min.css">
    <link rel="stylesheet" href="../stylesheets/style.css">
    <script src="../dist/js/coral.min.js"></script>
  </head>
  <body class="coral--light coral-Body--S u-coral-margin">
    <form id="data-element-configuration" class="coral-Form coral-FormGroup--labelsAbove">
      <h4 class="coral-Heading--M">Metric attribution</h4>

      <div id="metric-attribution-item-container" class="coral-FormGroup-item">
        <label id="metric-attribution-item-label" for="metric-attribution-item" class="coral-FormGroup-itemLabel coral-FieldLabel--left">
          Select an attribution to report
          <coral-icon icon="Asterisk" class="coral-FieldLabel-requiredIcon" size="XXS" alt="required"></coral-icon>
        </label>
        <div class="coral-InputGroup" style="width: 100%;" role="presentation">
          <coral-select id="metric-attribution-item" name="metricAttributionItem" class="coral-Form-field" labelledby="metric-attribution-item-label" style="width: 100%;">
            <coral-select-item value="connectionTime">Connection Time (TTFB)</coral-select-item>
            <coral-select-item value="dnsTime">DNS Time (TTFB)</coral-select-item>
            <coral-select-item value="element">Element (LCP)</coral-select-item>
            <coral-select-item value="elementRenderDelay">Element Render Delay (LCP)</coral-select-item>
            <coral-select-item value="eventEntry">Event Entry (FID, INP)</coral-select-item>
            <coral-select-item value="eventTarget">Event Target (FID, INP)</coral-select-item>
            <coral-select-item value="eventTime">Event Time (FID, INP)</coral-select-item>
            <coral-select-item value="eventType">Event Type (FID, INP)</coral-select-item>
            <coral-select-item value="fcpEntry">FCP Entry (FCP)</coral-select-item>
            <coral-select-item value="firstByteToFCP">First Byte To FCP (FCP)</coral-select-item>
            <coral-select-item value="largestShiftEntry">Largest Shift Entry (CLS)</coral-select-item>
            <coral-select-item value="largestShiftSource">Largest Shift Source (CLS)</coral-select-item>
            <coral-select-item value="largestShiftTarget">Largest Shift Target (CLS)</coral-select-item>
            <coral-select-item value="largestShiftTime">Largest Shift Time (CLS)</coral-select-item>
            <coral-select-item value="largestShiftValue">Largest Shift Value (CLS)</coral-select-item>
            <coral-select-item value="lcpEntry">LCP Entry (LCP)</coral-select-item>
            <coral-select-item value="lcpResourceEntry">LCP Resource Entry (LCP)</coral-select-item>
            <coral-select-item value="loadState">Load State (CLS, FCP, FID, INP)</coral-select-item>
            <coral-select-item value="navigationEntry">Navigation Entry (FCP, LCP, TTFB)</coral-select-item>
            <coral-select-item value="requestTime">Request Time (TTFB)</coral-select-item>
            <coral-select-item value="resourceLoadDelay">Resource Load Delay (LCP)</coral-select-item>
            <coral-select-item value="resourceLoadTime">Resource Load Time (LCP)</coral-select-item>
            <coral-select-item value="timeToFirstByte">Time to First Byte (FCP, LCP)</coral-select-item>
            <coral-select-item value="url">URL (LCP)</coral-select-item>
            <coral-select-item value="waitingTime">Waiting Time (TTFB)</coral-select-item>
          </coral-select>
        </div>
      </div>
    </form>

    <section class="coral-Well">
      <h4 class="coral-Heading--S coral-Heading--light">How this Data Element works</h4>
      <p>
        This Data Element returns the selected attribution of the measured metric. Attributions are
        potentially-helpful debugging information that can be sent along with the metric value for
        the current page visit in order to help identify issues happening to real-users in the
        field.
        <a class="coral-Link" href="https://github.com/GoogleChrome/web-vitals#attribution" target="_blank" rel="noopener noreferrer">
          Refer to the Web Vitals project to learn more about the
          <code class="coral-Code--XS">attribution</code> metric property.
        </a>
      </p>

      <coral-alert variant="warning">
        <coral-alert-header>
          Web Vitals <code class="coral-Code--XS">attribution</code> build required
        </coral-alert-header>
        <coral-alert-content>
          <p>
            If you are loading the Web Vitals library from your own URL, <em>and</em> you want to use
            this Data Element, then you <span class="text-underline">must</span> ensure that your
            Web Vitals library includes the <code class="coral-Code--XS">attribution</code> build.
            <a class="coral-Link" href="https://github.com/GoogleChrome/web-vitals#attribution-build" target="_blank" rel="noopener noreferrer">
              Learn more.
            </a>
          </p>
          <p>
            If you are loading the Web Vitals library from the one that is bundled with this extension
            or from the <code class="coral-Code--XS">unpkg.com</code> CDN, then the
            <code class="coral-Code--XS">attribution</code> build has been included already, so you can
            use this Data Element.
          </p>
        </coral-alert-content>
      </coral-alert>

      <p>
        <b>This data element <span class="text-underline">must</span> be used with an Event from
          this Web Vitals extension.</b>
      </p>
      <p>
        How to use:
      </p>
      <ul class="coral-List">
        <li class="coral-List-item"><code class="coral-Code--XS">%data element name%</code></li>
        <li class="coral-List-item"><code class="coral-Code--XS">_satellite.getVar('data element name', event)</code></li>
      </ul>
    </section>

    <hr class="coral-Divider--S">

    <footer class="coral--lightest coral-Body--XS">
      <div id="donations">
        <p>
          Donate: <a class="coral-Link" href="https://paypal.me/yuhuibc" target="_blank">PayPal</a>
        </p>
      </div>
      <div id="support">
        <p>
          Support Information
        </p>
        <ul class="coral-List">
          <li class="coral-List-item">
            <a class="coral-Link" href="https://github.com/yuhui/launchext-web-vitals/issues" target="_blank">
              Open a ticket
            </a>
          </li>
          <li class="coral-List-item">
            <a class="coral-Link" href="https://github.com/yuhui/launchext-web-vitals/blob/master/CHANGELOG.md" target="_blank">
              Read change log
            </a>
          </li>
        </ul>
      </div>

      <p>
        Copyright &copy; 2022 Yuhui. All rights reserved.
      </p>
      <p>
        <a class="coral-Link" href="https://yuhui.sg/terms-of-service.html" target="_blank">Terms of Service</a> |
        <a class="coral-Link" href="https://yuhui.sg/privacy-policy.html" target="_blank">Privacy Policy</a> |
        <a class="coral-Link" href="https://yuhui.sg/cookie-policy.html" target="_blank">Cookie Policy</a> |
        <a class="coral-Link" href="https://yuhui.sg/acceptable-use-policy.html" target="_blank">Acceptable Use Policy</a>
      </p>
    </footer>

    <script src="https://assets.adobedtm.com/activation/reactor/extensionbridge/extensionbridge.min.js"></script>
    <script src="../scripts/common.js"></script>
    <script>
      const FORM_ID = 'data-element-configuration';

      window.extensionBridge.register({
        init: (info) => {
          if (info.settings) {
            setFormValues(FORM_ID, info.settings);
          }
        },

        getSettings: () => {
          const formValues = getFormValues(FORM_ID);

          return formValues;
        },

        validate: () => {
          const formValues = getFormValues(FORM_ID);
          const { metricAttributionItem } = formValues;

          const acceptableMetricAttributionItems = [
            'connectionTime',
            'dnsTime',
            'element',
            'elementRenderDelay',
            'eventEntry',
            'eventTarget',
            'eventTime',
            'eventType',
            'fcpEntry',
            'firstByteToFCP',
            'largestShiftEntry',
            'largestShiftSource',
            'largestShiftTarget',
            'largestShiftTime',
            'largestShiftValue',
            'lcpEntry',
            'lcpResourceEntry',
            'loadState',
            'navigationEntry',
            'requestTime',
            'resourceLoadDelay',
            'resourceLoadTime',
            'timeToFirstByte',
            'url',
            'waitingTime',
          ];

          const metricAttributionItemIsValid = acceptableMetricAttributionItems.includes(
            metricAttributionItem
          );

          return metricAttributionItemIsValid;
        }
      });
    </script>
  </body>
</html>
